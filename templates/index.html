{% extends "layout.html" %}
{% block body %}

<script>
    $(document).ready(function() {
        $('#start_date').datepicker();
        $('#end_date').datepicker();

        $('#start_date_container').hide();
        $('#end_date_container').hide();
        $('#display_data_btn_container').hide();
        var data = [];
        var data_labels = [];

        $('#variables').change(function() {
            if ($('#start_date').val() == 'Start date' || $('#end_date').val() == 'End date') {
                $('#display_data_btn_container').hide();
            }

            if ($(this).val() == 'none') {
                $('#start_date_container').hide();
                $('#end_date_container').hide();
            }
            else {
                $('#start_date_container').show();
                $('#end_date_container').show();
            }
        });

        $('#start_date').change(function() {
            var start_date = $(this).val();
            var end_date = $('#end_date').val();
            if (start_date == '') {
                $(this).val('Start date');
                $('#display_data_btn_container').hide();
            }
            else {
                if (end_date != 'End date') {
                    $('#display_data_btn_container').show();
                }
            }
        });

        $('#end_date').change(function() {
            var end_date = $(this).val();
            var start_date = $('#start_date').val();
            if (end_date == '') {
                $(this).val('End date');
                $('#display_data_btn_container').hide();
            }
            else {
                if (start_date != 'Start date') {
                    $('#display_data_btn_container').show();
                }
            }
        });

        $('#btn_display_data').click(function() {
            variable = $('#variables').val();
            start_date = $('#start_date').val();
            end_date = $('#end_date').val();
            $.ajax({
                url: SCRIPT_ROOT + '/get_data',
                type: 'get',
                data: { variable: variable, start_date: start_date, end_date: end_date },
                contentType: 'application/json',
                cache: false
            }).done(function(result) {
                data = result.data;
                data_labels = result.data_labels;
                flot_data = [];
                for (var i=0; i<data.length; i++) {
                    flot_data.push({ label: data_labels[i], data: data[i] });
                }
                $.plot($("#plot_placeholder"), flot_data);
            }).fail(function(jqXHR, status, error) {
                console.log(error);
            });
        });
    });
</script>

<div class="row">
    <div class="col-lg-12">
        <h1 class="page-header">Dashboard</h1>
    </div>
</div>

<div class="row">
    <div class="col-lg-2">
        <div class="form-group">
            <select id="variables" class="form-control">
                <option value="none">Choose variable to display</option>
                {% for key in variable_keys %}
                    <option value={{ key }}>{{ variable_labels[loop.index-1] }}</option>
                {% endfor %}
            </select>
        </div>
    </div>
    <div class="col-lg-3">
        <div id="start_date_container" class="form-group"><input id="start_date" class="form-control" type="text" value="Start date" /></div>
    </div>
    <div class="col-lg-3">
        <div id="end_date_container" class="form-group"><input id="end_date" class="form-control" type="text" value="End date" /></div>
    </div>
    <div class="col-lg-1">
        <div id="display_data_btn_container" class="form-group"><button id="btn_display_data" class="btn btn-primary" type="button">Display data</button></div>
    </div>
</div>

<div id="plot_placeholder" style="width:1000px;height:400px"></div>

{% endblock %}
