{% extends "layout.html" %}
{% block body %}

<script>
    $(document).ready(function() {
        $('#start_date').datepicker();
        $('#end_date').datepicker();

        $('#start_date_container').hide();
        $('#end_date_container').hide();
        $('#display_data_btn_container').hide();
        var data = [];
        var data_labels = [];

        $('#variables').change(function() {
            $('#start_date').val('');
            $('#end_date').val('');
            $('#display_data_btn_container').hide();

            if ($(this).val() == 'none') {
                $('#start_date_container').hide();
                $('#end_date_container').hide();
            }
            else {
                $('#start_date_container').show();
                $('#end_date_container').show();
            }
        });

        $('#start_date').change(function() {
            var start_date = $(this).val();
            var end_date = $("#end_date").val();
            if (start_date == '' || end_date == '') {
                $('#display_data_btn_container').hide();
            }
            else {
                $('#display_data_btn_container').show();
            }
        });

        $('#end_date').change(function() {
            var end_date = $(this).val();
            var start_date = $("#start_date").val();
            if (start_date == '' || end_date == '') {
                $('#display_data_btn_container').hide();
            }
            else {
                $('#display_data_btn_container').show();
            }
        });

        $('#btn_display_data').click(function() {
            variable = $('#variables').val();
            start_date = $('#start_date').val();
            end_date = $('#end_date').val();
            $.ajax({
                url: SCRIPT_ROOT + '/get_data',
                type: 'get',
                data: { variable: variable, start_date: start_date, end_date: end_date },
                contentType: 'application/json',
                cache: false
            }).done(function(result) {
                data = result.data;
                data_labels = result.data_labels;
            }).fail(function(jqXHR, status, error) {
                console.log(error);
            });
        });
    });
</script>

<div>
    <div>
        <select id="variables">
            <option value="none">Choose variable to display</option>
            {% for key in variable_keys %}
                <option value={{ key }}>{{ variable_labels[loop.index-1] }}</option>
            {% endfor %}
        </select>
    </div>

    <div id="start_date_container">Start date: <input id="start_date" type="text" /></div>
    <div id="end_date_container">End date: <input id="end_date" type="text" /></div>
    <div id="display_data_btn_container"><input id="btn_display_data" type="button" value="Display data" /></div>
</div>

{% endblock %}
