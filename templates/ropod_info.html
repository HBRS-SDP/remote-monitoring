{% extends "layout.html" %}
{% block body %}

<style>
.green_dot {
    height: 25px;
    width: 25px;
    background-color: rgb(0, 255, 0);
    border-radius: 50%;
    display: inline-block;
}
.red_dot {
    height: 25px;
    width: 25px;
    background-color: rgb(255, 0, 0);
    border-radius: 50%;
    display: inline-block;
}
</style>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="{{ url_for('static', filename='datatables/js/jquery.dataTables.js') }}" type="text/javascript"></script>

<script>

    $(document).ready(function() {

        // ==================== get ropod ids =====================
        $('#operation_indicator').show();

        $.ajax({
            url: SCRIPT_ROOT + '/get_ropod_ids',
            type: 'get',
            contentType: 'application/json',
            cache: false
        }).done(function(result) {
            $.each(result.ropod_ids, function(i, ropod_id){
                $('#ropod_ids').append($('<option>', {
                    value: ropod_id,
                    text: ropod_id
                }));
            });
            $('#operation_indicator').hide();
        }).fail(function(jqXHR, status, error) {
            console.log(error);
            $('#operation_indicator').hide();
        });
        
        $('#ropod_ids').change(function() {
            ropod_id = $(this).val();

            if (ropod_id != 'none') {
                $('#btn_status').prop('disabled', false);
            }
            else {
                $('#btn_status').prop('disabled', true);
            }
        });

        // ==================== status button =====================
        $("#btn_status").click(function(){
            var status = undefined;
            var html_string = '';
            html_string += '<div class="panel-heading">Ropod status results</div><div class="panel-body"><table id="ropods" width="100%" class="table table-striped table-bordered table-hover"><thead><th>Fields</th><th>Status</th></thead><tbody>';
            var green_circle = '<span class="green_dot"></span>';
            var red_circle = '<span class="red_dot"></span>';

            $.ajax({
                url: SCRIPT_ROOT + '/get_ropod_status',
                type: 'get',
                data: {ropod_id: ropod_id},
                contentType: 'application/json',
                cache: false
            }).done(function(result){

                // status = result.status_list['payload']['status'];
                status = result.status_list.payload.status;
                $.each(status, function(key, val){
                    html_string += '<tr><td><h3>' + key + '</h3></td></tr>';

                    $.each(status[key], function(key2, val2){
                        var length = Object.keys(status[key][key2]).length;

                        if (Object.keys(status[key][key2]).length > 0) 
                        {
                            $.each(status[key][key2], function(key3, val3){
                                if (val3 == true) 
                                {
                                    html_string += '<tr><td>' + key3 + '</td><td>' + green_circle +'</td></tr>';
                                } 
                                else if (val3 == false)
                                {
                                    html_string += '<tr><td>' + key3 + '</td><td>' + red_circle +'</td></tr>';
                                } 
                                else
                                {
                                    html_string += '<tr><td>' + key3 + '</td><td>' + val3 +'</td></tr>';
                                }
                            });    
                        } 
                        else 
                        {
                            if (val2 == true) 
                            {
                                html_string += '<tr><td>' + key2 + '</td><td>' + green_circle +'</td></tr>';
                            } 
                            else if (val2 == false)
                            {
                                html_string += '<tr><td>' + key2 + '</td><td>' + red_circle +'</td></tr>';
                            } 
                            else
                            {
                                html_string += '<tr><td>' + key2 + '</td><td>' + val2 +'</td></tr>';
                            }
                        }
                    });
                });

                html_string += '</tbody></table></div>';

                $('#status_container').html('');
                $('#status_container').html(html_string);
                $('#status_container').prop('disabled', false);

            }).fail(function(jqXHR, status, error) {
                console.log(error);
            });

        });

    });
</script>


<div class="row">
    <div class="col-lg-12">
        <h1 class="page-header">Ropod info</h1>
    </div>
</div>

<div class="row">
    <div class="col-lg-3">
        <div class="form-group">
            <select id="ropod_ids" class="form-control">
                <option value="none">Choose ropod id</option>
            </select>
        </div>
    </div>

    <button id="btn_status" disabled="disabled" class="btn btn-primary" type="button">Get status</button>

    <div class="col-lg-1">
        <div id="operation_indicator" class="indicator"></div>
    </div>
</div>

<div id="status_container" disabled="disabled">
    <div class="panel panel-default">

    </div>
</div>

{% endblock %}

