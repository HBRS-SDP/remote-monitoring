{% extends "layout.html" %}
{% block body %}

<style>
.green_dot {
    height: 10px;
    width: 10px;
    background-color: rgb(0, 255, 0);
    border-radius: 50%;
    display: inline-block;
}
.red_dot {
    height: 10px;
    width: 10px;
    background-color: rgb(255, 0, 0);
    border-radius: 50%;
    display: inline-block;
}
.grey_dot {
    height: 10px;
    width: 10px;
    background-color: rgb(128, 128, 128);
    border-radius: 50%;
    display: inline-block;
}
</style>

<script src="{{ url_for('static', filename='datatables/js/jquery.dataTables.js') }}" type="text/javascript"></script>
<script src="{{ url_for('static', filename='jquery-1.11.2.min.js') }}" type="text/javascript"></script>
<script src="{{ url_for('static', filename='socket.io.slim.js') }}" type="text/javascript"></script>

<script>
    $(document).ready(function() {
        $('#error_message_container').hide();
        $('#operation_indicator').hide();
    });

    var socket = io.connect('http://' + document.domain + ':' + location.port + '/ropod_status');
    socket.on('deployed_ropods', function(msg) {
        $("#ropod_list tr:not(:first)").remove()
        var t = document.getElementById('ropod_list');
        data = JSON.parse(msg.data)
        for (var i = 0; i < data.length; i++)
        {
            var r = t.insertRow(-1);
            var c = r.insertCell(-1);
            r.insertCell(-1);
            r.insertCell(-1);
            r.insertCell(-1);
            r.insertCell(-1);
            c.innerHTML = data[i]
        }
    });
    socket.on('zyre_peers', function(msg) {
        var t = document.getElementById('ropod_list');
        data = JSON.parse(msg.data);
        for (var i = 1, row; row = t.rows[i]; i++)
        {
            // if current row exists in zyre_peers
            if (data.indexOf(row.cells[0].innerHTML) > -1)
            {
                row.cells[1].innerHTML = '<span class="green_dot"></span>'
                row.cells[1].style.textAlign = 'center';
                row.cells[1].style.verticalAlign = 'middle';
            }
            else
            {
                row.cells[1].innerHTML = '<span class="red_dot"></span>'
                row.cells[1].style.textAlign = 'center';
                row.cells[1].style.verticalAlign = 'middle';

                row.cells[2].innerHTML = '<span class="grey_dot"></span>'
                row.cells[2].style.textAlign = 'center';
                row.cells[2].style.verticalAlign = 'middle';
            }
        }
    });

</script>

<div class="row">
    <div class="col-lg-12">
        <h1 class="page-header">Ropod info</h1>
    </div>
</div>

<div class="row">
    <div class="col-lg-1">
        <div id="operation_indicator" class="indicator"></div>
    </div>
</div>

<div id="error_message_container" class="alert alert-danger alert-dismissible">
    <a href="#" class="close" onclick="$('.alert').hide()">&times;</a>
    <p id="error_message_container_content"></p>
</div>

<div id="overall_ropod_status_container" class="ropod_table" disabled="disabled">
    <table id="ropod_list" width="100%" class="table table-striped table-bordered table-hover">
        <thead>
            <th width="70%">Ropod</th>
            <th width="5%">Online</th>
            <th width="5%">Status</th>
            <th width="10%">Status time</th>
            <th width="10%">Detailed status</th>
        </thead>
        <tbody>
        </tbody>
    </table>
    <div class="panel panel-default">
    </div>
</div>

<div id="status_container" disabled="disabled">
    <div class="panel panel-default">
    </div>
</div>

{% endblock %}
